<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    
    <%- include("../../templates/head-pwa") %>
        <%- include("../../templates/master/cabecera") %>
            <link rel="stylesheet" href="/css/dashboard.css">
</head>

<body>
    <input type="hidden" id="rol" value="<%= rol %> ">
    <div class="container-scroller">
        <!-- navcabecera -->
        <%- include("../../templates/master/navCabecera") %>
            <div class="container-fluid page-body-wrapper">
                <!-- nav lateral -->
                <%- include("../../templates/master/navLateral") %>
                    <div class="main-panel">
                        <div class="content-wrapper">
                            <div class="page-header">
                                <h3 class="page-title">Dashboard</h3>
                                <nav aria-label="breadcrumb">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                                        <li class="breadcrumb-item active" aria-current="page">Activos</li>
                                    </ol>
                                </nav>
                            </div>
                            <!-- Botones de exportación en tu toolbar -->
                                <div class="btn-group" role="group">
                                <button id="btnExportarCSV" class="btn btn-outline-primary">
                                    <i class="fas fa-file-csv"></i> CSV
                                </button>
                                <button id="btnExportarJSON" class="btn btn-outline-primary">
                                    <i class="fas fa-file-code"></i> JSON
                                </button>
                                </div>

                                    <!-- Loading indicator para estadísticas -->
                                <div class="card" id="estadisticasCard">
                                <!-- Tu contenido actual -->
                                </div>                     
                                  <!-- Sección de filtros para Salidas -->
                             <% if (tipo === 'salidas') { %>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h4 class="card-title mb-4">
                                                <i class="mdi mdi-filter-multiple"></i> Filtros
                                            </h4>
                                            <div class="row g-3">
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaInicio" >Fecha Inicio</label>
                                                        <input type="date" class="form-control" id="filtroFechaInicio">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaFin">Fecha Fin</label>
                                                        <input type="date" class="form-control" id="filtroFechaFin">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroRancho">Rancho</label>
                                                        <select class="form-control" id="filtroAlmacen">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroTemporada">Temporada</label>
                                                        <select class="form-control" id="filtroTemporada">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCombustible">Combustible</label>
                                                        <select class="form-control" id="filtroCombustible">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCentroCoste">Centro de Coste</label>
                                                        <select class="form-control" id="filtroCentroCoste">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEmpresa">Empresa</label>
                                                        <select class="form-control" id="filtroEmpresa">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <button id="btnResetFiltros" class="btn btn-outline-secondary">
                                                        <i class="mdi mdi-refresh"></i> Limpiar Filtros
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                             <!-- Sección de filtros para entradas -->
                             <% if (tipo === 'entradas') { %>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h4 class="card-title mb-4">
                                                <i class="mdi mdi-filter-multiple"></i> Filtros
                                            </h4>
                                            <div class="row g-3">
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaInicio" >Fecha Inicio</label>
                                                        <input type="date" class="form-control" id="filtroFechaInicio">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaFin" >Fecha Fin</label>
                                                        <input type="date" class="form-control" id="filtroFechaFin">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroRancho" >Rancho</label>
                                                        <select class="form-control" id="filtroAlmacen">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCombustible" >Combustible</label>
                                                        <select class="form-control" id="filtroCombustible">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCentroCoste" >Centro de Coste</label>
                                                        <select class="form-control" id="filtroCentroCoste">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEmpresa" >Empresa</label>
                                                        <select class="form-control" id="filtroEmpresa">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <button id="btnResetFiltros" class="btn btn-outline-secondary">
                                                        <i class="mdi mdi-refresh"></i> Limpiar Filtros
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <!-- Sección de filtros para cargas -->
                            <% if (tipo === 'cargas') { %>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h4 class="card-title mb-4">
                                                <i class="mdi mdi-filter-multiple"></i> Filtros
                                            </h4>
                                            <div class="row g-3">
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaInicio" >Fecha Inicio</label>
                                                        <input type="date" class="form-control" id="filtroFechaInicio">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaFin" >Fecha Fin</label>
                                                        <input type="date" class="form-control" id="filtroFechaFin">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCombustible" >Combustible</label>
                                                        <select class="form-control" id="filtroCombustible">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCentroCoste" >Centro de Coste</label>
                                                        <select class="form-control" id="filtroCentroCoste">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEmpresa" >Empresa</label>
                                                        <select class="form-control" id="filtroEmpresa">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <button id="btnResetFiltros" class="btn btn-outline-secondary">
                                                        <i class="mdi mdi-refresh"></i> Limpiar Filtros
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <% if (tipo === 'solicitudes') { %>
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h4 class="card-title mb-4">
                                                <i class="mdi mdi-filter-multiple"></i> Filtros
                                            </h4>
                                            <div class="row g-3">
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaInicio" >Fecha Inicio</label>
                                                        <input type="date" class="form-control" id="filtroFechaInicio">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroFechaFin" >Fecha Fin</label>
                                                        <input type="date" class="form-control" id="filtroFechaFin">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroRanchos" >Rancho</label>
                                                        <select class="form-control" id="filtroRancho">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroUsuario" >Solicitante</label>
                                                        <select class="form-control" id="filtroUsuario">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroMetodoAplicacion" >Método Aplicación</label>
                                                        <select class="form-control" id="filtroMetodoAplicacion">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroPresentacion" >Presentación</label>
                                                        <select class="form-control" id="filtroPresentacion">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroTemporada" >Temporada</label>
                                                        <select class="form-control" id="filtroTemporada">
                                                            <option value="">Todas</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroTipo" >Tipo Solicitud</label>
                                                        <select class="form-control" id="filtroTipo">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCentroCoste" >Centro de Coste</label>
                                                        <select class="form-control" id="filtroCentroCoste">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEmpresa" >Empresa</label>
                                                        <select class="form-control" id="filtroEmpresa">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroProducto" >Productos</label>
                                                        <select class="form-control" id="filtroProducto">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEficiencia" >Eficiencia</label>
                                                        <select class="form-control" id="filtroEficiencia">
                                                            <option value="">Todos</option>
                                                            <option value="alta">Alta (>95%)</option>
                                                            <option value="media">Media (80-95%)</option>
                                                            <option value="baja">Baja (<80%)</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroTiempoEntrega" >Tiempo de Entrega</label>
                                                        <select class="form-control" id="filtroTiempoEntrega">
                                                            <option value="">Todos</option>
                                                            <option value="1">1 día o menos</option>
                                                            <option value="3">3 días o menos</option>
                                                            <option value="7">1 semana o menos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <button id="btnResetFiltros" class="btn btn-outline-secondary">
                                                        <i class="mdi mdi-refresh"></i> Limpiar Filtros
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <!-- Sección de filtros para activos -->
                            <% if (tipo === 'activos') { %>
                                  <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card shadow-sm">
                                        <div class="card-body">
                                            <h4 class="card-title mb-4">
                                                <i class="mdi mdi-filter-multiple"></i> Filtros
                                            </h4>
                                            <div class="row g-3">
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroCentroCoste">Centro de Coste</label>
                                                        <select class="form-control" id="filtroCentroCoste">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEmpresa">Empresa</label>
                                                        <select class="form-control" id="filtroEmpresa">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroEstado">Estatus</label>
                                                        <select class="form-control" id="filtroEstado">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroTipoActivo">Activo</label>
                                                        <select class="form-control" id="filtroTipoActivo">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroDepartamentos">Departamentos</label>
                                                        <select class="form-control" id="filtroDepartamentos">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-2 col-md-3 col-sm-6">
                                                    <div class="form-group mb-0">
                                                        <label for="filtroUbicacion">Ubicacion</label>
                                                        <select class="form-control" id="filtroUbicacion">
                                                            <option value="">Todos</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <button id="btnResetFiltros" class="btn btn-outline-secondary">
                                                        <i class="mdi mdi-refresh"></i> Limpiar Filtros
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <!-- Resumen de estadísticas -->
                            <div class="row mb-4 dashboard-stats">

                                <% if (tipo === 'salidas' || tipo === 'entradas' || tipo === 'cargas') { %>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="totalSalidas">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-success">
                                                        <span class="mdi mdi-arrow-top-right icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Total Salidas</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div id="combustibleTotales" class="d-flex flex-column justify-content-center">
                                                        <!-- Los totales por tipo de combustible se insertarán aquí desde JS -->
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-primary">
                                                        <span class="mdi mdi-gas-station icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Total Combustible (L)</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="promedioSalidas">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-warning">
                                                        <span class="mdi mdi-chart-line icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Promedio por Salida</h6>
                                        </div>
                                    </div>
                                </div>
                                 <% } %>
                                <% if (tipo === 'salidas' || tipo === 'entradas') { %>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="almacenesActivos">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-info">
                                                        <span class="mdi mdi-warehouse icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Almacenes Activos</h6>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                                <% if (tipo === 'cargas') { %>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="almacenesActivos">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-info">
                                                        <span class="mdi <%= tipo === 'cargas' ? 'mdi-truck' : 'mdi-warehouse' %> icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">
                                                <%= tipo === 'cargas' ? 'Unidades Activas' : 'Almacenes Activos' %>
                                            </h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <div class="d-flex align-items-center align-self-start">
                                                            <h3 class="mb-0" id="gastoTotales">0</h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-info">
                                                            <span class="mdi mdi-cash-multiple icon-item"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h6 class="text-muted font-weight-normal">
                                                Gasto total
                                                </h6>
                                            </div>
                                    </div>
                                </div>
                                <% } %>
                                <% if (tipo === 'solicitudes') { %>
                                <div class="row">
                                    <div class="col-xl-4 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <h6 class="text-muted font-weight-normal mb-3">Total Solicitudes</h6>
                                                        <div id="totalSalidas" class="mb-2">
                                                            <!-- Aquí se insertará el total general -->
                                                        </div>
                                                        <div id="totalPorTipo" class="small">
                                                            <!-- Los totales por tipo se insertarán aquí -->
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-success">
                                                            <span class="mdi mdi-arrow-top-right icon-item"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-4 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <h6 class="text-muted font-weight-normal mb-3">Cantidad por Presentación</h6>
                                                        <div id="presentacionTotales">
                                                            <!-- Aquí se insertan dinámicamente los datos -->
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-primary">
                                                            <span class="mdi mdi-package-variant icon-item"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-4 col-sm-6 grid-margin stretch-card">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-9">
                                                            <h6 class="text-muted font-weight-normal mb-3">Solicitudes por Status</h6>
                                                            <div id="statusTotales">
                                                                <!-- Aquí se insertarán dinámicamente los totales por status -->
                                                            </div>
                                                        </div>
                                                        <div class="col-3">
                                                            <div class="icon icon-box-warning">
                                                                <span class="mdi mdi-clipboard-check icon-item"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    </div>

                                    <div class="col-xl-6 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <h6 class="text-muted font-weight-normal mb-3">Tiempos de Entrega</h6>
                                                        <div id="tiempoEntregaTotales">
                                                            <!-- Se insertará dinámicamente -->
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-info">
                                                            <span class="mdi mdi-clock-outline icon-item"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xl-6 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <h6 class="text-muted font-weight-normal mb-3">Eficiencia de Cumplimiento</h6>
                                                        <div id="eficienciaTotales">
                                                            <!-- Se insertará dinámicamente -->
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-success">
                                                            <span class="mdi mdi-percent icon-item"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>        
                                <% } %>
                                <% if (tipo === 'activos') { %>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="totalSalidas">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-success">
                                                        <span class="mdi mdi-archive icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Total Activos</h6>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-9">
                                                    <div class="d-flex align-items-center align-self-start">
                                                        <h3 class="mb-0" id="totalDepartamentos">0</h3>
                                                    </div>
                                                </div>
                                                <div class="col-3">
                                                    <div class="icon icon-box-info">
                                                        <span class="mdi mdi-office-building icon-item"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h6 class="text-muted font-weight-normal">Departamentos</h6>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                            </div>

                            <!-- Gráficas -->
                            <% if (tipo === 'salidas') { %>
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title" data-chart-type="combustible">
                                                 <%= tipo === 'salidas' ? 'Consumo' : 'entradas' %> por Tipo de Combustible
                                            </h4>
                                            <p class="card-description">Distribución del consumo por tipo de combustible
                                            </p>
                                            <canvas id="combustibleChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Almacén</h4>
                                            <p class="card-description">Distribución del consumo por almacén</p>
                                            <canvas id="almacenChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-8 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Centro de Coste</h4>
                                            <p class="card-description">Top 10 centros de coste con mayor consumo</p>
                                            <canvas id="centroCosteChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Temporada</h4>
                                            <p class="card-description">Distribución por temporada</p>
                                            <canvas id="temporadaChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
        
                            </div>
                            <div class="row">
                                <div class="col-md-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Empresa</h4>
                                            <p class="card-description">Distribución por empresa</p>
                                             <canvas id="empresaChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                            <% if (tipo === 'entradas') { %>
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title" data-chart-type="combustible">
                                                 <%= tipo === 'salidas' ? 'Consumo' : 'entradas' %> por Tipo de Combustible
                                            </h4>
                                            <p class="card-description">Distribución del consumo por tipo de combustible
                                            </p>
                                            <canvas id="combustibleChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Almacén</h4>
                                            <p class="card-description">Distribución del consumo por almacén</p>
                                            <canvas id="almacenChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                    
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Centro de Coste</h4>
                                            <p class="card-description">Top 10 centros de coste con mayor consumo</p>
                                            <canvas id="centroCosteChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Empresa</h4>
                                            <p class="card-description">Distribución por empresa</p>
                                             <canvas id="empresaChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>

                            <% if (tipo === 'cargas') { %>
                            <div class="row">

                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title" data-chart-type="combustible">
                                                 <%= tipo === 'salidas' ? 'Consumo' : 'entradas' %> por Tipo de Combustible
                                            </h4>
                                            <p class="card-description">Distribución del consumo por tipo de combustible
                                            </p>
                                            <canvas id="combustibleChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
  
                                <div class="col-md-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Empresa</h4>
                                            <p class="card-description">Distribución por empresa</p>
                                             <canvas id="empresaChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-lg-12 grid-margin stretch-card">
                                    
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Centro de Coste</h4>
                                            <p class="card-description">Top 10 centros de coste con mayor consumo</p>
                                            <canvas id="centroCosteChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                   
                            </div>

                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Cargas por Unidad</h4>
                                            <p class="card-description">Top 10 unidades con mayor consumo</p>
                                            <canvas id="unidadChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Rendimiento por Unidad</h4>
                                            <p class="card-description">Top 10 unidades por rendimiento (km/L)</p>
                                            <canvas id="rendimientoChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <% if (tipo === 'solicitudes') { %>
                            <!-- En graficas.ejs, dentro de la sección de solicitudes -->
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <h4 class="card-title">Eficiencia por Tipo</h4>
                                            <canvas id="eficienciaChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <h4 class="card-title">Top Productos</h4>
                                            <canvas id="productoChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Segunda fila de gráficas -->
                            <div class="row">
                                <div class="col-lg-12 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <h4 class="card-title">Análisis Temporal</h4>
                                            <canvas id="timelineChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Gráficas adicionales -->
                            <div class="row">
                                <!-- Gráfica de Tiempos de Entrega -->
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Tiempos de Entrega</h4>
                                            <canvas id="tiempoEntregaChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gráfica de Variedades -->
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Variedades</h4>
                                            <canvas id="variedadChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gráfica de Método de Aplicación -->
                            <div class="row">
                                <div class="col-lg-12 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Distribución por Método de Aplicación</h4>
                                            <canvas id="metodoChart" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-8 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Centro de Coste</h4>
                                            <p class="card-description">Top 10 centros de coste con mayor consumo</p>
                                            <canvas id="centroCosteChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Consumo por Temporada</h4>
                                            <p class="card-description">Distribución por temporada</p>
                                            <canvas id="temporadaChart" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
        
                            </div>

                            <!-- En graficas.ejs -->
                            <div class="row">
                                <!-- Gráficas existentes -->
                                
                                <!-- Nueva gráfica de tendencias -->
                                <div class="col-lg-12 grid-margin stretch-card">
                                    <div class="card">
                                        <div class="card-body">
                                            <h4 class="card-title">Tendencia de Solicitudes</h4>
                                            <canvas id="empresaChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <% if (tipo === 'activos') { %>
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Activos por Empresa</h4>
                                            <p class="card-description">Distribución de activos entre empresas</p>
                                            <canvas id="combustibleChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Activos por Ubicación/Rancho</h4>
                                            <p class="card-description">Localización física de activos (top 10)</p>
                                            <canvas id="almacenChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Activos por Estado</h4>
                                            <p class="card-description">Condición operacional de activos</p>
                                            <canvas id="empresaChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Activos por Tipo de Equipo</h4>
                                            <p class="card-description">Clasificación por tipo de equipo</p>
                                            <canvas id="centroCosteChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6 grid-margin stretch-card">
                                    <div class="card chart-card">
                                        <div class="card-body">
                                            <h4 class="card-title">Activos Por Departamento</h4>
                                            <p class="card-description">Localización física de activos por departamento</p>
                                            <canvas id="departamentoChart" height="300"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                            <!-- INICIA: Nueva sección para la tabla de detalles -->
                        </div>
                        <!-- content-wrapper ends -->
                        <!-- partial:partials/_footer.html -->
                        <%- include("../../templates/master/footer") %>
                            <!-- partial -->
                    </div>
                    <!-- main-panel ends -->
            </div>
            <!-- page-body-wrapper ends -->
    </div>
    <!-- Modal -->
    <!-- container-scroller -->
    <%- include("../../templates/master/scripts") %>
       <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

        <script >
           window.dashboardData = <%- JSON.stringify(data) %>;
           window.dashboardTipo ="<%= tipo %>";
        </script>
        <script type="module" src="/app/admin/graficas.js"></script>
</body>

</html>